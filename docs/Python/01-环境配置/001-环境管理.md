# 环境管理

> 默认系统（mac）上安装 `Python 3.14.0` 版本

## pyenv 安装与配置

使用 pyenv 来管理多个 Python 版本，这样你可以轻松地在不同项目中使用不同版本的 Python。

```bash
# 使用 Homebrew 安装 pyenv
brew install pyenv

# 编辑 zsh 配置文件
nano ~/.zshrc

# 在文件末尾添加：
export PYENV_ROOT="$HOME/.pyenv"
export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"

# 保存并退出（Ctrl+O → 回车 → Ctrl+X），然后重新加载配置：
source ~/.zshrec

# 安装 Python 3.11.0
pyenv install 3.11.0

# 查看已安装的 Python 版本
pyenv versions

# 设置 Python 版本 全局:
pyenv global 3.11.0

# 设置 Python 版本 项目级:
cd /path/to/your/project
pyenv local 3.11.0

# 验证安装
python --version

# 也可以随时切换回 3.14.0：
pyenv local 3.14.0
python --version  # 输出 Python 3.14.0
```

## 包管理工具 PDM 安装与配置

### 使用 pipx（推荐用于全局安装）

```bash
# 全局安装
pipx install pdm

# 验证安装
pdm --version
```

### 初始化配置（可选）

```bash
pdm config --list
```

### 开始使用

```bash
# 初始化 PDM
pdm init

# 添加依赖
pdm add requests
pdm add -d pytest  # 作为开发依赖

# 运行脚本
pdm run python your_script.py
```

### 通过 scripts 快捷启动

你可以在 `pyproject.toml `中定义快捷命令，方便启动项目。

1. 添加启动脚本

编辑 `pyproject.toml，`添加 `[tool.pdm.scripts] `部分：

```toml
[tool.pdm.scripts]
start = "python app.py"
dev = "python app.py --debug"
test = "pytest"
lint = "flake8 ."
format = "black ."
```

2. 使用方式

```bash
pdm run start   # 相当于 pdm run python app.py
pdm run dev     # 启动调试模式
pdm run test    # 运行测试
pdm run lint    # 检查代码风格
```

### `pdm shell` 报错

PDM 版本（2.26.0）中 `shell` 命令已经被移除了。

```bash
# 查看可用的虚拟环境
pdm venv list

# 1. 创建虚拟环境
pdm venv create

# 激活虚拟环境（假设使用默认的venv）
pdm venv activate
# 或者：
source .venv/bin/activate  # Linux/Mac
# 或者 Windows: .venv\Scripts\activate

```

### pyproject.toml 配置 PDM 脚本命令

```toml
[tool.pdm.scripts]

app.cmd = "python app/main.py"    # 执行的命令
app.env_file = ".env"             # 加载的环境变量文件
```

运行这个脚本: `pdm run app`

当你运行 `pdm run app` 时，PDM 会：

1. 加载环境变量：首先从 `.env `文件读取所有环境变量

2. 执行命令：然后运行 `python app/main.py`

3. 使用虚拟环境：自动使用当前项目的虚拟环境中的 Python 解释器

### 启动常见 Web 框架示例

1. FastAPI / Starlette（使用 Uvicorn）

```toml
[tool.pdm.scripts]
start = "uvicorn app:app --reload --host 0.0.0.0 --port 8000"
```

2. Flask

```toml
[tool.pdm.scripts]
start = "flask --app app run --debug --port 5000"

```

或者：

```toml
[tool.pdm.scripts]
start = "python app.py"
```

在 app.py 中：

```py
if __name__ == "__main__":
    app.run(debug=True, port=5000)
```

3. Django

```toml
[tool.pdm.scripts]
runserver = "python manage.py runserver 8000"
migrate = "python manage.py migrate"
```

```bash
pdm run runserver
```

### 查看当前 Python 和环境

```bash
cd /path/to/project
pdm info
```

输出示例：

```bash
PDM version:
  2.26.0
Python Interpreter:
  /Users/houfei/Desktop/labelllm/backend/.venv/bin/python (3.11)
Project Root:
  /Users/houfei/Desktop/labelllm/backend
Local Packages:
  /Users/houfei/Desktop/labelllm/backend/.venv/lib/python3.11/site-packages
```

指定 Python 版本

```bash
pdm use 3.11
# 或
pdm use /usr/bin/python3.11
```
