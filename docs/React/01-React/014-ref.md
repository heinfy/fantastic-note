`ref`（引用）是 React 提供的一种**访问 DOM 节点或类组件实例的“逃生舱”机制**，用于在典型数据流（props/state）之外**直接操作底层元素**。

---

### 一、核心理解

#### 1. **本质**
- `ref` 是一个**可变对象**，其 `.current` 属性指向被绑定的值。
- 创建方式：
  ```jsx
  const myRef = useRef(initialValue); // 函数组件
  this.myRef = React.createRef();      // 类组件
  ```

#### 2. **与 state 的区别**
|          | `state`                     | `ref`                          |
|----------|----------------------------|--------------------------------|
| 更新触发 | 触发 re-render             | **不触发 re-render**           |
| 用途     | 驱动 UI 变化               | 存储**不影响 UI 的瞬时值**     |
| 响应式   | 是                         | 否                             |

> ✅ `ref` 是“非响应式”的存储容器。

---

### 二、主要应用场景

#### ✅ 1. **访问 DOM 元素（最常见）**
```jsx
function TextInput() {
  const inputRef = useRef(null);

  const focusInput = () => {
    inputRef.current.focus(); // 直接调用 DOM API
  };

  return (
    <>
      <input ref={inputRef} />
      <button onClick={focusInput}>聚焦</button>
    </>
  );
}
```
> 适用于：表单聚焦、滚动到指定位置、媒体播放控制等。

---

#### ✅ 2. **保存跨渲染的可变值（类似类实例属性）**
```jsx
function Timer() {
  const intervalRef = useRef();

  useEffect(() => {
    intervalRef.current = setInterval(() => {
      // ...
    }, 1000);
    return () => clearInterval(intervalRef.current);
  }, []);
}
```
> ✅ 避免在 `useEffect`/`setTimeout` 中捕获过期闭包（stale closure）。

---

#### ✅ 3. **访问子组件实例（仅限类组件），集成第三方 DOM 库**
```jsx
// 子组件必须是类组件
class Child extends React.Component {
  sayHello = () => console.log('Hello');
  render() { return <div>Child</div>; }
}

// 父组件
function Parent() {
  const childRef = useRef();
  const callChild = () => {
    childRef.current.sayHello(); // 调用子组件方法
  };
  return <Child ref={childRef} />;
}
```
> ⚠️ **函数组件无法直接使用 ref 获取实例**（需配合 `forwardRef` + `useImperativeHandle`）。

---

#### ✅ 4. **测量 DOM 尺寸或位置**
```jsx
function MeasureBox() {
  const boxRef = useRef();
  const [size, setSize] = useState({ width: 0, height: 0 });

  useEffect(() => {
    const { width, height } = boxRef.current.getBoundingClientRect();
    setSize({ width, height });
  }, []);

  return <div ref={boxRef}>尺寸: {size.width} x {size.height}</div>;
}
```

---
### 总结

| 场景 | 是否推荐 |
|------|--------|
| 操作 DOM（聚焦、滚动等） | ✅ 强烈推荐 |
| 保存定时器 ID、WebSocket 实例等 | ✅ 推荐 |
| 替代 state 存储 UI 状态 | ❌ 禁止 |
| 父组件调用子组件方法 | ⚠️ 谨慎使用（优先通过 props 通信） |
