---
id: rc01_005
title: 005-æ–°æ—§ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”
description: æ–°æ—§ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”
keywords: [React]
tags:
  - React
hide_title: true
sidebar_position: 5
custom_edit_url: null
---

React 16 æ˜¯ React å‘å±•å²ä¸Šçš„ä¸€ä¸ª**é‡å¤§åˆ†æ°´å²­**ï¼Œå®ƒå¼•å…¥äº†å…¨æ–°çš„åè°ƒå¼•æ“ **Fiber**ï¼Œä¸ä»…é‡æ„äº†åº•å±‚æ¶æ„ï¼Œè¿˜**åºŸå¼ƒ/æ›¿æ¢äº†ä¸€äº›æ—§çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•**ï¼Œä»¥æ”¯æŒ**å¼‚æ­¥æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰** å’Œæ›´å®‰å…¨çš„æ›´æ–°æœºåˆ¶ã€‚

ä¸‹é¢ä» **ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„å˜åŒ–** å’Œ **åº•å±‚ä¼˜åŒ–** ä¸¤ä¸ªç»´åº¦è¯¦ç»†å¯¹æ¯”ï¼š

---

## ä¸€ã€React 16 ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸï¼ˆLegacy ç”Ÿå‘½å‘¨æœŸï¼‰

### ç»å…¸ä¸‰é˜¶æ®µï¼š

#### 1. **Mountingï¼ˆæŒ‚è½½ï¼‰**

- `constructor()`
- `componentWillMount()` âš ï¸
- `render()`
- `componentDidMount()`

#### 2. **Updatingï¼ˆæ›´æ–°ï¼‰**

- `componentWillReceiveProps(nextProps)` âš ï¸
- `shouldComponentUpdate(nextProps, nextState)`
- `componentWillUpdate()` âš ï¸
- `render()`
- `componentDidUpdate(prevProps, prevState)`

#### 3. **Unmountingï¼ˆå¸è½½ï¼‰**

- `componentWillUnmount()`

---

### æ—§ç”Ÿå‘½å‘¨æœŸæµ‹è¯•ä»£ç 

```jsx
import React from 'react';
import ReactDOM from 'react-dom';

class Son extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      count: 0
    };
    console.log('constructor');
  }
  componentWillMount() {
    console.log('componentWillMount');
  }
  componentDidMount() {
    console.log('componentDidMount');
  }
  componentWillUnmount() {
    console.log('componentWillUnmount');
  }
  componentWillReceiveProps(nextProps, nextContext) {
    console.log('componentWillReceiveProps nextProps', nextProps);
    console.log('componentWillReceiveProps nextContext', nextContext);
  }
  shouldComponentUpdate(nextProps, nextState, nextContext) {
    console.log('shouldComponentUpdate nextProps', nextProps);
    console.log('shouldComponentUpdate nextState', nextState);
    console.log('shouldComponentUpdate nextContext', nextContext);
    return true;
  }
  componentWillUpdate() {
    console.log('componentWillUpdate');
  }
  componentDidUpdate() {
    console.log('componentDidUpdate');
  }
  add = () => {
    this.setState({
      count: this.state.count + 1
    });
  };
  death = () => {
    ReactDOM.unmountComponentAtNode(document.getElementById('root'));
  };
  update = () => {
    this.forceUpdate();
  };
  render() {
    console.log('render');
    return (
      <fieldset>
        <legend>count: {this.state.count}</legend>
        <button onClick={this.add}>Count + 1</button>
        <button onClick={this.death}>å¸è½½ç»„ä»¶</button>
        <button onClick={this.update}>å¼ºåˆ¶æ›´æ–°ç»„ä»¶</button>
      </fieldset>
    );
  }
}

class Parent extends React.Component {
  componentWillUnmount() {
    console.log('Parent - componentWillUnmount');
  }
  render() {
    return (
      <div>
        <p>çˆ¶ç»„ä»¶</p>
        <Son />
      </div>
    );
  }
}

export default Parent;
```

## äºŒã€React 16.3+ å¼•å…¥çš„[æ–°ç”Ÿå‘½å‘¨æœŸ](https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/)ï¼ˆModern Lifecycleï¼‰

### ä¸»è¦å˜åŒ–ï¼š**åºŸå¼ƒä¸‰ä¸ªâ€œwillâ€æ–¹æ³•**ï¼Œå¼•å…¥ä¸¤ä¸ªæ–°æ–¹æ³•

| æ—§æ–¹æ³•ï¼ˆä¸å®‰å…¨ï¼‰ | æ–°æ›¿ä»£æ–¹æ¡ˆ |
|----------------|----------|
| `componentWillMount` | â†’ ç§»å…¥ `constructor` æˆ– `componentDidMount` |
| `componentWillReceiveProps` | â†’ **`static getDerivedStateFromProps`** |
| `componentWillUpdate` | â†’ **`getSnapshotBeforeUpdate`**ï¼ˆé…åˆ `componentDidUpdate`ï¼‰ |

### âœ… æ–°ç”Ÿå‘½å‘¨æœŸå®Œæ•´æµç¨‹ï¼š

#### Mounting:
- `constructor()`
- `static getDerivedStateFromProps(props, state)` ï¼ˆé¦–æ¬¡æ¸²æŸ“ä¹Ÿè°ƒç”¨ï¼‰
- `render()`
- `componentDidMount()`

#### Updating:
- `static getDerivedStateFromProps(props, state)`
- `shouldComponentUpdate()`
- `render()`
- `getSnapshotBeforeUpdate(prevProps, prevState)` â† **æ–°å¢**
- `componentDidUpdate(prevProps, prevState, snapshot)`

#### Unmounting:
- `componentWillUnmount()`

### getDerivedStateFromProps(props, state)

`static getDerivedStateFromProps(props, state)` æ˜¯ä¸€ä¸ª**é™æ€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•**ï¼Œç”¨äºåœ¨ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„ props æ—¶ï¼Œ**å®‰å…¨åœ°æ´¾ç”Ÿï¼ˆderiveï¼‰state**ã€‚å®ƒçš„è®¾è®¡ç›®çš„æ˜¯**æ›¿ä»£ä¸å®‰å…¨çš„ `componentWillReceiveProps`**ï¼Œå¹¶ç¡®ä¿ä¸ React çš„å¼‚æ­¥æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰å…¼å®¹ã€‚

âœ… å…³é”®ç‰¹æ€§ï¼š

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **é™æ€æ–¹æ³•** | ä¸èƒ½è®¿é—® `this`ï¼ˆæ— ç»„ä»¶å®ä¾‹ï¼‰ |
| **çº¯å‡½æ•°** | ä¸èƒ½åŒ…å«å‰¯ä½œç”¨ï¼ˆå¦‚ API è°ƒç”¨ã€è®¢é˜…ï¼‰ |
| **æ¯æ¬¡æ¸²æŸ“éƒ½è°ƒç”¨** | åŒ…æ‹¬**é¦–æ¬¡æŒ‚è½½**å’Œ**åç»­æ›´æ–°** |
| **å¿…é¡»è¿”å›å¯¹è±¡æˆ– null** | è¿”å›å€¼ä¼šæµ…åˆå¹¶åˆ° state |

### getSnapshotBeforeUpdate(prevProps, prevState)

`getSnapshotBeforeUpdate(prevProps, prevState)` æ˜¯ React 16.3 å¼•å…¥çš„ä¸€ä¸ª**ç”Ÿå‘½å‘¨æœŸæ–¹æ³•**ï¼Œå®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š  
> **åœ¨ DOM æ›´æ–°ï¼ˆcommitï¼‰ä¹‹å‰ï¼Œæ•è·ä¸€äº›å¯èƒ½åœ¨æ›´æ–°åä¸¢å¤±çš„ä¿¡æ¯ï¼ˆå¦‚æ»šåŠ¨ä½ç½®ã€å°ºå¯¸ç­‰ï¼‰ï¼Œå¹¶å°†è¿™ä¸ªâ€œå¿«ç…§â€ä¼ é€’ç»™ `componentDidUpdate`ã€‚**

#### ğŸŒ° å…¸å‹åœºæ™¯ï¼šèŠå¤©çª—å£ä¿æŒæ»šåŠ¨ä½ç½®
- ç”¨æˆ·æ­£åœ¨çœ‹èŠå¤©è®°å½•åº•éƒ¨ã€‚
- æ–°æ¶ˆæ¯æ¥äº†ï¼Œåˆ—è¡¨å˜é•¿ã€‚
- å¦‚æœç›´æ¥æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œä¼šæ‰“æ–­ç”¨æˆ·é˜…è¯»ã€‚
- **ç†æƒ³è¡Œä¸º**ï¼šå¦‚æœç”¨æˆ·åœ¨åº•éƒ¨ï¼Œåˆ™è‡ªåŠ¨æ»šåŠ¨åˆ°åº•ï¼›å¦åˆ™ä¿æŒå½“å‰ä½ç½®ã€‚

ç¤ºä¾‹ä»£ç ï¼š
```jsx
class ScrollingList extends React.Component {
  listRef = React.createRef();

  // âœ… åœ¨ DOM æ›´æ–°å‰è°ƒç”¨
  getSnapshotBeforeUpdate(prevProps, prevState) {
    // æ£€æŸ¥åˆ—è¡¨æ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨
    const list = this.listRef.current;
    const isAtBottom = list.scrollHeight - list.scrollTop === list.clientHeight;
    
    // è¿”å›â€œå¿«ç…§â€ â†’ ä¼šè¢«ä¼ ç»™ componentDidUpdate
    return isAtBottom;
  }

  // âœ… åœ¨ DOM æ›´æ–°åè°ƒç”¨ï¼Œæ¥æ”¶ snapshot
  componentDidUpdate(prevProps, prevState, snapshot) {
    if (snapshot) {
      // å¦‚æœæ›´æ–°å‰åœ¨åº•éƒ¨ï¼Œåˆ™æ»šåŠ¨åˆ°åº•éƒ¨
      const list = this.listRef.current;
      list.scrollTop = list.scrollHeight;
    }
  }

  render() {
    return (
      <div ref={this.listRef} style={{ height: '200px', overflow: 'auto' }}>
        {this.props.items.map(item => <div key={item.id}>{item.text}</div>)}
      </div>
    );
  }
}
```
#### âœ… å…³é”®ç‰¹æ€§ï¼š

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **è°ƒç”¨æ—¶æœº** | åœ¨ **render ä¹‹åã€DOM æ›´æ–°ä¹‹å‰**ï¼ˆcommit é˜¶æ®µå¼€å§‹å‰ï¼‰ |
| **è¿”å›å€¼** | ä»»æ„å€¼ï¼ˆé€šå¸¸ä¸ºå¯¹è±¡ã€å¸ƒå°”å€¼ã€æ•°å­—ç­‰ï¼‰ï¼Œä¼šä½œä¸º **ç¬¬ä¸‰ä¸ªå‚æ•°** ä¼ ç»™ `componentDidUpdate` |
| **å¿…é¡»é…åˆ `componentDidUpdate`** | å•ç‹¬ä½¿ç”¨æ— æ„ä¹‰ï¼Œå¿«ç…§éœ€åœ¨æ›´æ–°åå¤„ç† |
| **å¯ä»¥è®¿é—® DOM** | æ­¤æ—¶æ—§ DOM ä»å­˜åœ¨ï¼Œå¯å®‰å…¨è¯»å–å¸ƒå±€ä¿¡æ¯ |

#### æ‰§è¡Œæµç¨‹å›¾è§£

```
çˆ¶ç»„ä»¶æ›´æ–°
    â†“
[render é˜¶æ®µ]
  â†’ render() è¿”å›æ–°è™šæ‹Ÿ DOM
    â†“
[commit é˜¶æ®µå¼€å§‹]
  â†’ getSnapshotBeforeUpdate(prevProps, prevState) 
      â†’ è¯»å–æ—§ DOM çŠ¶æ€ï¼ˆå¦‚ scrollTopï¼‰
      â†’ è¿”å› snapshot
    â†“
  â†’ React æ›´æ–°çœŸå® DOM
    â†“
  â†’ componentDidUpdate(prevProps, prevState, snapshot)
      â†’ ä½¿ç”¨ snapshot æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆå¦‚æ»šåŠ¨ï¼‰
```

> ğŸ’¡ **å…³é”®ç‚¹**ï¼š  
> `getSnapshotBeforeUpdate` æ˜¯ **å”¯ä¸€èƒ½åœ¨ DOM æ›´æ–°å‰è¯»å–æ—§ DOM çŠ¶æ€** çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚

### æ–°ç”Ÿå‘½å‘¨æœŸæµ‹è¯•ä»£ç 

```jsx
import React, { Component } from 'react';

class Son extends Component {
  state = {
    msg: 'è¿™æ˜¯å­ç»„ä»¶'
  };
  static getDerivedStateFromProps(nextProps, prevState) {
    console.group('å­ç»„ä»¶ - shouldComponentUpdate');
    console.log(nextPropsï¼Œ prevState);
    console.groupEnd('å­ç»„ä»¶ - shouldComponentUpdate');
    return nextProps.num > 0.5 ? { num: nextProps.num } : null;
  }
  render() {
    return (
      <div style={{ margin: 10, padding: 10, border: '1px solid red' }}>
        <p>{this.state.msg}</p>
        <p>å­ç»„ä»¶æ¥æ”¶çˆ¶ç»„ä»¶çš„ num å€¼ï¼ˆå­ç»„ä»¶å¤§äº 0.5 æ—¶æ›´æ–°ï¼‰ï¼š{this.state.num}</p>
      </div>
    );
  }
}

class Fa extends Component {
  state = {
    name: 'è¿™æ˜¯çˆ¶ç»„ä»¶',
    num: 'è¿™æ˜¯çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ é€’çš„å€¼',
    arr: [1, 2, 3, 4, 5]
  };
  static getDerivedStateFromProps(nextProps, prevState) {
    console.group('çˆ¶ç»„ä»¶ - getDerivedStateFromProps');
    console.log(nextProps);
    console.log(prevState);
    console.groupEnd('çˆ¶ç»„ä»¶ - getDerivedStateFromProps');
    /**
     * è¿™é‡Œè¿”å› null æˆ–è€… ä¸€ä¸ªå¯¹è±¡
     * å½“éœ€è¦æ›´æ–°çŠ¶æ€æ—¶ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„å†…å®¹ï¼Œä¼šæ·»åŠ åˆ° state ä¸­ï¼Œå¦‚æœ state ä¸­å·²ç»åŒ…å«æŸå±æ€§ï¼Œåˆ™è¦†ç›–åŸæ¥çš„å±æ€§
     * å½“ä¸éœ€è¦æ›´æ–°çŠ¶æ€æ—¶ï¼Œéœ€è¦è¿”å› null
     */
    return {
      name: 'getDerivedStateFromProps è¦†ç›–åŸnameå±æ€§',
      notDefine: 'æœªåœ¨stateå£°æ˜,æ­¤æ—¶æ·»åŠ åˆ° state'
    };
  }
  componentDidMount() {
    console.group('çˆ¶ç»„ä»¶ - componentDidMount');
    console.log(this.state);
    console.groupEnd('çˆ¶ç»„ä»¶ - componentDidMount');
  }
  shouldComponentUpdate(nextProps, nextState, nextContext) {
    console.group('çˆ¶ç»„ä»¶ - shouldComponentUpdate');
    console.log(nextProps);
    console.log(nextState);
    console.log(nextContext);
    console.groupEnd('çˆ¶ç»„ä»¶ - shouldComponentUpdate');
    // åˆ¤æ–­æ˜¯å¦ rerender
    return nextState;
  }
  /**
   * è·å–ä¸Šæ¬¡çš„ props å’Œ state æ•°æ®
   * å¹¶ä¸”è¿”å› null æˆ–è€… objectï¼Œç„¶åå°†è¿”å›å€¼ä½œä¸º snapshotï¼Œä¼ é€’ç»™ componentDidUpdateç¬¬ä¸‰ä¸ªå‚æ•°
   */
  getSnapshotBeforeUpdate(prevProps, prevState) {
    console.group('çˆ¶ç»„ä»¶ - getSnapshotBeforeUpdate');
    console.log(prevProps);
    console.log(prevState);
    console.groupEnd('çˆ¶ç»„ä»¶ - getSnapshotBeforeUpdate');
    return {
      msg: 'from getSnapshotBeforeUpdate'
    };
  }
  componentDidUpdate(prevProps, prevState, snapshot) {
    console.group('çˆ¶ç»„ä»¶ - componentDidUpdate');
    console.log(prevProps);
    console.log(prevState);
    console.log(snapshot);
    console.groupEnd('çˆ¶ç»„ä»¶ - componentDidUpdate');
  }
  changeStr = () => {
    this.setState({
      num: Math.random()
    });
  };

  render() {
    const { name, num, arr } = this.state;
    return (
      <div style={{ margin: 10, padding: 10, border: '1px solid blue' }}>
        {name}ï¼š<button onClick={this.changeStr.bind(this)}>æ”¹å˜ num çš„å€¼</button>
        <p>è¿™æ˜¯çˆ¶ç»„ä»¶çš„ num å€¼: {num}</p>
        <Son
          num={num}
          arr={arr}
        ></Son>
      </div>
    );
  }
}

export default Fa;
```

---

## ä¸‰ã€ä¸ºä»€ä¹ˆåºŸå¼ƒæ—§çš„ â€œwillâ€ æ–¹æ³•ï¼Ÿ

### æ ¸å¿ƒåŸå› ï¼š**å®ƒä»¬ä¸å¼‚æ­¥æ¸²æŸ“ï¼ˆConcurrent Modeï¼‰ä¸å…¼å®¹**

#### âŒ é—®é¢˜ 1ï¼š`componentWillMount` / `componentWillUpdate` å¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨
- åœ¨ Fiber æ¶æ„ä¸‹ï¼ŒReact å¯èƒ½**æš‚åœã€ä¸­æ–­ã€é‡å¯**æ¸²æŸ“è¿‡ç¨‹ã€‚
- è¿™äº›æ–¹æ³•å¯èƒ½æ‰§è¡Œå¤šæ¬¡ï¼Œå¯¼è‡´ï¼š
  - é‡å¤è®¢é˜…ï¼ˆå†…å­˜æ³„æ¼ï¼‰
  - å¤šæ¬¡ API è°ƒç”¨ï¼ˆå‰¯ä½œç”¨ä¸å¯æ§ï¼‰

> âœ… è§£å†³æ–¹æ¡ˆï¼š  
> - åˆå§‹åŒ–é€»è¾‘ â†’ æ”¾åˆ° `constructor`ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰  
> - å‰¯ä½œç”¨ï¼ˆå¦‚ API è°ƒç”¨ï¼‰â†’ æ”¾åˆ° `componentDidMount`ï¼ˆä¿è¯åªæ‰§è¡Œä¸€æ¬¡ï¼‰

#### âŒ é—®é¢˜ 2ï¼š`componentWillReceiveProps` å®¹æ˜“å¼•å‘ bug
- å¼€å‘è€…å¸¸åœ¨è¿™é‡ŒåšçŠ¶æ€æ´¾ç”Ÿï¼Œä½†å®¹æ˜“å†™å‡º**åæ¨¡å¼**ï¼š
  ```js
  // å±é™©ï¼props å˜åŒ–æ—¶é‡ç½® stateï¼Œä½†å¯èƒ½è¦†ç›–ç”¨æˆ·è¾“å…¥
  componentWillReceiveProps(nextProps) {
    if (nextProps.userID !== this.props.userID) {
      this.setState({ comments: [] }); // ä¸¢å¤±æœªä¿å­˜çš„è‰ç¨¿ï¼
    }
  }
  ```

> âœ… è§£å†³æ–¹æ¡ˆï¼š  
> ä½¿ç”¨ **`static getDerivedStateFromProps`**ï¼ˆçº¯å‡½æ•°ï¼Œæ— å‰¯ä½œç”¨ï¼‰ï¼š
> ```js
> static getDerivedStateFromProps(props, state) {
>   if (props.userID !== state.prevUserID) {
>     return {
>       prevUserID: props.userID,
>       comments: [],
>     };
>   }
>   return null; // ä¸æ›´æ–° state
> }
> ```

#### âŒ é—®é¢˜ 3ï¼šæ— æ³•è·å– DOM æ›´æ–°å‰çš„çŠ¶æ€
- æ¯”å¦‚æ»šåŠ¨ä½ç½®ã€å°ºå¯¸ç­‰ï¼Œåœ¨ `componentDidUpdate` ä¸­å·²å¤±æ•ˆã€‚

> âœ… è§£å†³æ–¹æ¡ˆï¼š  
> æ–°å¢ **`getSnapshotBeforeUpdate`**ï¼š
> ```js
> getSnapshotBeforeUpdate(prevProps, prevState) {
>   // åœ¨ DOM æ›´æ–°å‰è¯»å– scrollHeight
>   if (prevProps.list.length < this.props.list.length) {
>     const list = this.listRef.current;
>     return list.scrollHeight - list.scrollTop;
>   }
>   return null;
> }
>
> componentDidUpdate(prevProps, prevState, snapshot) {
>   if (snapshot !== null) {
>     const list = this.listRef.current;
>     list.scrollTop = list.scrollHeight - snapshot; // ä¿æŒæ»šåŠ¨ä½ç½®
>   }
> }
> ```

---

## å››ã€React 16 çš„æ ¸å¿ƒä¼˜åŒ–ï¼šFiber æ¶æ„

### ğŸ§  ä»€ä¹ˆæ˜¯ Fiberï¼Ÿ
- Fiber æ˜¯ React 16 é‡å†™çš„**åè°ƒï¼ˆReconciliationï¼‰ç®—æ³•**ã€‚
- å°†åŸæœ¬**é€’å½’çš„åŒæ­¥æ¸²æŸ“**æ”¹ä¸º**å¯ä¸­æ–­çš„é“¾è¡¨éå†**ã€‚

### âœ… å…³é”®ä¼˜åŒ–ï¼š

| ä¼˜åŒ–ç‚¹ | è¯´æ˜ |
|-------|------|
| **å¯ä¸­æ–­æ¸²æŸ“** | é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ï¼‰å¯æ‰“æ–­ä½ä¼˜å…ˆçº§æ›´æ–°ï¼ˆå¦‚åå°æ•°æ®åŠ è½½ï¼‰ |
| **æ—¶é—´åˆ‡ç‰‡ï¼ˆTime Slicingï¼‰** | å°†é•¿ä»»åŠ¡æ‹†åˆ†ä¸ºå°å—ï¼Œåœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œï¼Œé¿å…å¡é¡¿ |
| **é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰** | æ–°å¢ `componentDidCatch`ï¼Œé˜²æ­¢ç»„ä»¶é”™è¯¯å¯¼è‡´æ•´ä¸ªåº”ç”¨å´©æºƒ |
| **Portals** | é€šè¿‡ `ReactDOM.createPortal` å°†å­èŠ‚ç‚¹æ¸²æŸ“åˆ° DOM æ ‘ä»»æ„ä½ç½®ï¼ˆå¦‚ Modalï¼‰ |
| **Fragment** | æ”¯æŒè¿”å›å¤šä¸ªå…ƒç´ è€Œæ— éœ€åŒ…è£¹ `<div>`ï¼ˆ`<>...</>`ï¼‰ |

> ğŸ’¡ **Fiber çš„ç›®æ ‡**ï¼šè®© React åº”ç”¨æ›´æµç•…ã€å“åº”æ›´å¿«ï¼Œå°¤å…¶åœ¨ä½ç«¯è®¾å¤‡ä¸Šã€‚

---

## äº”ã€ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”è¡¨ï¼ˆä¸€ç›®äº†ç„¶ï¼‰

| é˜¶æ®µ | React â‰¤15 | React â‰¥16.3ï¼ˆæ¨èï¼‰ | è¯´æ˜ |
|------|-----------|---------------------|------|
| **æŒ‚è½½å‰** | `componentWillMount` | â€” | å·²åºŸå¼ƒ |
| **æ¥æ”¶æ–° props** | `componentWillReceiveProps` | `static getDerivedStateFromProps` | çº¯å‡½æ•°ï¼Œæ— å‰¯ä½œç”¨ |
| **æ›´æ–°å‰** | `componentWillUpdate` | `getSnapshotBeforeUpdate` | è·å– DOM æ›´æ–°å‰å¿«ç…§ |
| **é”™è¯¯æ•è·** | â€” | `componentDidCatch` | æ–°å¢é”™è¯¯è¾¹ç•Œ |
| **æ¸²æŸ“** | `render` | `render` | ä¸å˜ |
| **æŒ‚è½½å** | `componentDidMount` | `componentDidMount` | ä¸å˜ |
| **æ›´æ–°å** | `componentDidUpdate` | `componentDidUpdate` | æ¥æ”¶ `snapshot` å‚æ•° |
| **å¸è½½** | `componentWillUnmount` | `componentWillUnmount` | ä¸å˜ |

---


## æ€»ç»“

| æ–¹é¢ | React 16 ä¹‹å‰ | React 16+ |
|------|--------------|----------|
| **æ¶æ„** | Stack Reconcilerï¼ˆåŒæ­¥é€’å½’ï¼‰ | Fiber Reconcilerï¼ˆå¼‚æ­¥å¯ä¸­æ–­ï¼‰ |
| **ç”Ÿå‘½å‘¨æœŸ** | åŒ…å«ä¸å®‰å…¨çš„ â€œwillâ€ æ–¹æ³• | å®‰å…¨ã€å¯é¢„æµ‹çš„æ–°æ–¹æ³• |
| **æ¸²æŸ“æ€§èƒ½** | é•¿ä»»åŠ¡é˜»å¡ä¸»çº¿ç¨‹ | æ—¶é—´åˆ‡ç‰‡ï¼Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¼˜å…ˆ |
| **é”™è¯¯å¤„ç†** | ç»„ä»¶é”™è¯¯å¯¼è‡´ç™½å± | é”™è¯¯è¾¹ç•Œéš”ç¦»é”™è¯¯ |
| **å¼€å‘ä½“éªŒ** | ç±»ç»„ä»¶ä¸ºä¸» | å‡½æ•°ç»„ä»¶ + Hooks æˆä¸»æµ |

> ğŸ’¡ **æœ¬è´¨**ï¼šReact 16 ä¸åªæ˜¯å¢åŠ åŠŸèƒ½ï¼Œè€Œæ˜¯ä¸º**æœªæ¥å¼‚æ­¥æ¸²æŸ“å’Œå¹¶å‘æ¨¡å¼**æ‰“ä¸‹åŸºç¡€ã€‚ç”Ÿå‘½å‘¨æœŸçš„å˜æ›´ï¼Œæ˜¯ä¸ºäº†è®©å¼€å‘è€…å†™å‡º**æ›´å¥å£®ã€å¯é¢„æµ‹**çš„ä»£ç ã€‚

å¦‚ä»Šï¼ˆReact 18+ï¼‰ï¼Œ**å‡½æ•°ç»„ä»¶ + Hooks å·²æˆä¸ºé¦–é€‰**ï¼Œç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé€æ¸æˆä¸ºâ€œå†å²çŸ¥è¯†â€ï¼Œä½†ç†è§£å…¶æ¼”è¿›é€»è¾‘å¯¹æ·±å…¥æŒæ¡ React è‡³å…³é‡è¦ã€‚