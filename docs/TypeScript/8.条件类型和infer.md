åœ¨ TypeScript ä¸­ï¼Œ**æ¡ä»¶ç±»å‹ï¼ˆConditional Typesï¼‰** æ˜¯ä¸€ç§**æ ¹æ®ç±»å‹ä¹‹é—´çš„å…³ç³»åŠ¨æ€é€‰æ‹©æˆ–è½¬æ¢ç±»å‹**çš„é«˜çº§ç‰¹æ€§ã€‚å®ƒçš„è¯­æ³•ç±»ä¼¼äº JavaScript ä¸­çš„ä¸‰å…ƒè¡¨è¾¾å¼ï¼ˆ`condition ? trueType : falseType`ï¼‰ï¼Œä½†ä½œç”¨äº**ç±»å‹å±‚é¢**ï¼Œè€Œéå€¼å±‚é¢ã€‚

> âœ… **æ ¸å¿ƒæ€æƒ³**ï¼š  
> **â€œå¦‚æœç±»å‹ A æ»¡è¶³æŸç§æ¡ä»¶ï¼Œåˆ™è¿”å›ç±»å‹ Bï¼Œå¦åˆ™è¿”å›ç±»å‹ Cã€‚â€**

---

### ğŸ”§ åŸºæœ¬è¯­æ³•

```ts
SomeType extends OtherType ? TrueType : FalseType
```

- `extends` åœ¨è¿™é‡Œè¡¨ç¤º **â€œå¯èµ‹å€¼æ€§â€ï¼ˆassignabilityï¼‰**ï¼Œå³ `SomeType` æ˜¯å¦å…¼å®¹ `OtherType`ã€‚
- æ•´ä¸ªè¡¨è¾¾å¼åœ¨**ç¼–è¯‘æ—¶**æ±‚å€¼ï¼Œä¸äº§ç”Ÿä»»ä½•è¿è¡Œæ—¶ä»£ç ã€‚

---

### âœ… ç®€å•ç¤ºä¾‹

```ts
type IsString<T> = T extends string ? true : false;

type A = IsString<'hello'>;  // true
type B = IsString<42>;       // false
type C = IsString<string>;   // true
```

---

### ğŸŒŸ å®é™…åº”ç”¨åœºæ™¯

#### 1. **æ³›å‹ä¸­çš„ç±»å‹è¿‡æ»¤ï¼ˆExtract / Excludeï¼‰**

TypeScript å†…ç½®çš„ `Exclude` å’Œ `Extract` å°±æ˜¯æ¡ä»¶ç±»å‹çš„ç»å…¸åº”ç”¨ï¼š

```ts
// æ’é™¤æŸäº›ç±»å‹
type Exclude<T, U> = T extends U ? never : T;

type T0 = Exclude<'a' | 'b' | 'c', 'a'>; // 'b' | 'c'

// æå–å¯èµ‹å€¼çš„ç±»å‹
type Extract<T, U> = T extends U ? T : never;

type T1 = Extract<'a' | 'b' | 1 | 2, string>; // 'a' | 'b'
```

#### 2. **å¤„ç†å‡½æ•°å‚æ•°æˆ–è¿”å›å€¼**

```ts
type ReturnType<T> = T extends (...args: any) => infer R ? R : never;

function add(a: number, b: number): number {
  return a + b;
}

type AddResult = ReturnType<typeof add>; // number
```

> ğŸ” è¿™é‡Œç”¨åˆ°äº† `infer` å…³é”®å­— â€”â€” å®ƒå…è®¸ä½ ä»æ¡ä»¶ä¸­â€œæ¨æ–­â€å‡ºä¸€ä¸ªç±»å‹å˜é‡ï¼ˆå¦‚ `R`ï¼‰ã€‚


#### 3. **æ‰å¹³åŒ–åµŒå¥—ç±»å‹ï¼ˆFlatteningï¼‰**

```ts
type Flatten<T> = T extends Array<infer Item> ? Item : T;

type T2 = Flatten<string[]>;    // string
type T3 = Flatten<number>;      // numberï¼ˆä¸æ˜¯æ•°ç»„ï¼Œä¿æŒåŸæ ·ï¼‰
```

#### 4. **æ ¹æ®è¾“å…¥ç±»å‹å†³å®šè¾“å‡ºç±»å‹**

```ts
type Process<T> = T extends string
  ? { value: T; type: 'string' }
  : T extends number
  ? { value: T; type: 'number' }
  : { value: T; type: 'other' };

type T4 = Process<'hello'>; // { value: 'hello'; type: 'string' }
type T5 = Process<42>;      // { value: 42; type: 'number' }
```

---

### âš ï¸ åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ï¼ˆDistributive Conditional Typesï¼‰

å½“æ¡ä»¶ç±»å‹çš„å·¦ä¾§æ˜¯ä¸€ä¸ª**è£¸ç±»å‹å‚æ•°ï¼ˆnaked type parameterï¼‰**ï¼Œä¸”ä¼ å…¥çš„æ˜¯**è”åˆç±»å‹**æ—¶ï¼ŒTypeScript ä¼šè‡ªåŠ¨å¯¹è”åˆç±»å‹çš„æ¯ä¸ªæˆå‘˜åˆ†åˆ«åº”ç”¨æ¡ä»¶ï¼Œå†åˆå¹¶ç»“æœã€‚

```ts
type ToArray<T> = T extends any ? T[] : never;

type StrNum = ToArray<string | number>; 
// ç­‰ä»·äºï¼š
//   (string extends any ? string[] : never) |
//   (number extends any ? number[] : never)
// ç»“æœï¼šstring[] | number[]
```

> ğŸ’¡ â€œè£¸ç±»å‹å‚æ•°â€æŒ‡ `T` ç›´æ¥å‡ºç°åœ¨ `extends` å·¦ä¾§ï¼Œè€Œä¸æ˜¯è¢«åŒ…è£¹ï¼ˆå¦‚ `[T]`ã€`Promise<T>` ç­‰ï¼‰ã€‚

å¦‚æœä½ **ä¸æƒ³åˆ†å¸ƒ**ï¼Œå¯ä»¥åŠ ä¸€å±‚åŒ…è£…ï¼š

```ts
type ToArrayNonDist<T> = [T] extends [any] ? T[] : never;
type T6 = ToArrayNonDist<string | number>; // (string | number)[]
```

---

### âœ… ä¸ºä»€ä¹ˆéœ€è¦æ¡ä»¶ç±»å‹ï¼Ÿ

- å®ç°**é«˜åº¦å¤ç”¨çš„å·¥å…·ç±»å‹**ï¼ˆå¦‚ `Partial`ã€`Required`ã€`Pick` ç­‰åº•å±‚éƒ½ä¾èµ–å®ƒï¼‰
- æ ¹æ®è¾“å…¥ç±»å‹**æ™ºèƒ½æ¨å¯¼è¾“å‡ºç±»å‹**
- æ„å»º**ç±»å‹å®‰å…¨çš„ API**ï¼Œæ¯”å¦‚ ORMã€çŠ¶æ€ç®¡ç†åº“ç­‰

---

### ğŸ“Œ æ€»ç»“

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| **è¯­æ³•** | `T extends U ? X : Y` |
| **ä½œç”¨** | åœ¨ç±»å‹ç³»ç»Ÿä¸­å®ç°â€œif-elseâ€é€»è¾‘ |
| **å…³é”®èƒ½åŠ›** | ç±»å‹è¿‡æ»¤ã€ç±»å‹æå–ã€ç±»å‹æ˜ å°„ã€é…åˆ `infer` æ¨æ–­ |
| **å…¸å‹ç”¨é€”** | å·¥å…·ç±»å‹ã€å‡½æ•°é‡è½½æ¨¡æ‹Ÿã€API ç±»å‹è®¾è®¡ |
| **æ³¨æ„** | è”åˆç±»å‹ä¼šè§¦å‘â€œåˆ†å¸ƒå¼â€è¡Œä¸º |

> ğŸ’¡ **ä¸€å¥è¯è®°ä½**ï¼š  
> **æ¡ä»¶ç±»å‹ = ç±»å‹ä¸–ç•Œçš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œè®©ç±»å‹ä¹Ÿèƒ½â€œåšåˆ¤æ–­â€ã€‚**

å®ƒæ˜¯ TypeScript ç±»å‹ç³»ç»Ÿå›¾çµå®Œå¤‡çš„å…³é”®ç‰¹æ€§ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æ„å»ºé«˜çº§ç±»å‹å·¥å…·çš„åŸºçŸ³ã€‚

## infer å…³é”®å­—

`infer` æ˜¯ TypeScript ä¸­ç”¨äº**æ¡ä»¶ç±»å‹ä¸­çš„ç±»å‹æ¨æ–­**çš„å…³é”®å­—ã€‚å®ƒå…è®¸ä½ åœ¨æ³›å‹æ¡ä»¶ç±»å‹ä¸­å£°æ˜ä¸€ä¸ªå¾…æ¨æ–­çš„ç±»å‹å˜é‡ã€‚

`infer` åªèƒ½åœ¨ `extends` æ¡ä»¶ç±»å‹çš„å­å¥ä¸­ä½¿ç”¨ï¼Œç”¨äºæå–ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚

### 1. æå–å‡½æ•°è¿”å›ç±»å‹

```typescript
type ReturnType<T> = T extends (...args: any[]) => infer R ? R : never;

function foo() {
  return 123;
}

type FooReturn = ReturnType<typeof foo>; // number
```

### 2. æå–å‡½æ•°å‚æ•°ç±»å‹

```typescript
type Parameters<T> = T extends (...args: infer P) => any ? P : never;

function bar(x: string, y: number) {}
type BarParams = Parameters<typeof bar>; // [string, number]
```

### 3. æå–æ•°ç»„/å…ƒç»„å…ƒç´ ç±»å‹

```typescript
type ElementType<T> = T extends (infer U)[] ? U : never;

type NumArray = number[];
type Num = ElementType<NumArray>; // number

type StrArray = string[];
type Str = ElementType<StrArray>; // string
```

### 4. æå– Promise çš„è§£æç±»å‹

```typescript
type UnwrapPromise<T> = T extends Promise<infer U> ? U : T;

type PromiseNumber = Promise<number>;
type NumberType = UnwrapPromise<PromiseNumber>; // number

type NotPromise = string;
type StringType = UnwrapPromise<NotPromise>; // string
```

### 5. é€’å½’è§£æ„ç±»å‹

```typescript
// æå–å¤šå±‚ Promise
type DeepUnwrapPromise<T> = T extends Promise<infer U> ? DeepUnwrapPromise<U> : T;

type DeepPromise = Promise<Promise<number>>;
type DeepNumber = DeepUnwrapPromise<DeepPromise>; // number
```

### 6. æå–æ„é€ å‡½æ•°å®ä¾‹ç±»å‹

```typescript
type InstanceType<T> = T extends new (...args: any[]) => infer R ? R : any;

class MyClass {}
type MyInstance = InstanceType<typeof MyClass>; // MyClass
```

### 7. è”åˆç±»å‹ä¸­çš„æ¨æ–­

```typescript
// æå–æ‰€æœ‰å‡½æ•°çš„è¿”å›ç±»å‹
type AllReturnTypes<T> = T extends any ? (T extends (...args: any[]) => infer R ? R : never) : never;

type Functions = [() => string, () => number];
type Returns = AllReturnTypes<Functions>; // string | number
```

## å®é™…åº”ç”¨ç¤ºä¾‹

### 1. è·¯ç”±å‚æ•°æå–

```typescript
type ExtractRouteParams<T> = T extends `${string}:${infer Param}/${infer Rest}` ? Param | ExtractRouteParams<`${Rest}`> : T extends `${string}:${infer Param}` ? Param : never;

type Route = '/user/:id/post/:postId';
type Params = ExtractRouteParams<Route>; // "id" | "postId"
```

### 2. å“åº”æ•°æ®å¤„ç†

```typescript
type ApiResponse<T> = {
  data: T;
  status: number;
};

type ExtractApiData<T> = T extends ApiResponse<infer U> ? U : never;

type UserResponse = ApiResponse<{ name: string; age: number }>;
type UserData = ExtractApiData<UserResponse>; // { name: string; age: number }
```

### 3. é€’å½’ç±»å‹å¤„ç†

```typescript
// å°†åµŒå¥—æ•°ç»„å±•å¹³
type Flatten<T> = T extends Array<infer U> ? Flatten<U> : T;

type NestedArray = [1, [2, [3, 4]], 5];
type FlatArray = Flatten<NestedArray>; // 1 | 2 | 3 | 4 | 5
```
