## ä¸€ã€ä»€ä¹ˆæ˜¯ **å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰**ï¼Ÿ

### âœ… å®šä¹‰ï¼š
> **å•ä¾‹æ¨¡å¼** æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç¡®ä¿ä¸€ä¸ªç±»**åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹**ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚

### ğŸ§© æ ¸å¿ƒç‰¹ç‚¹ï¼š
1. **ç§æœ‰æ„é€ å‡½æ•°**ï¼ˆé˜²æ­¢å¤–éƒ¨ newï¼‰
2. **é™æ€æ–¹æ³•æˆ–å±æ€§** è¿”å›å”¯ä¸€å®ä¾‹
3. **å®ä¾‹åªåˆ›å»ºä¸€æ¬¡**

### ğŸ“Œ JavaScript ä¸­çš„ç»å…¸å•ä¾‹ç¤ºä¾‹ï¼š
```js
class Database {
  constructor() {
    if (Database.instance) {
      return Database.instance; // å·²å­˜åœ¨å°±è¿”å›
    }
    this.data = {};
    Database.instance = this; // ä¿å­˜å”¯ä¸€å®ä¾‹
  }

  getData(key) { return this.data[key]; }
  setData(key, value) { this.data[key] = value; }
}

// ä½¿ç”¨
const db1 = new Database();
const db2 = new Database();
console.log(db1 === db2); // true â†’ æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼
```

âœ… è¿™å°±æ˜¯â€œå•ä¾‹â€ï¼šæ— è®ºä½  `new` å¤šå°‘æ¬¡ï¼Œæ‹¿åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

---

## äºŒã€ESM æ¨¡å—æ˜¯å•ä¾‹

### âœ… ç®€å•è¯´ï¼š
> **åœ¨ ES æ¨¡å—ï¼ˆESMï¼‰ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ¨¡å—æ–‡ä»¶ï¼ˆ`.js` æ–‡ä»¶ï¼‰åªä¼šè¢«åŠ è½½å’Œæ‰§è¡Œä¸€æ¬¡**ã€‚  
> åç»­çš„ `import` éƒ½ä¼š**å¤ç”¨ç¬¬ä¸€æ¬¡åŠ è½½çš„ç»“æœ**ï¼Œè€Œä¸æ˜¯é‡æ–°æ‰§è¡Œæ¨¡å—ä»£ç ã€‚

è¿™å°±ä½¿å¾— **æ¨¡å—å†…éƒ¨çš„çŠ¶æ€ï¼ˆå˜é‡ã€å‡½æ•°ç­‰ï¼‰å¤©ç„¶å…·æœ‰â€œå•ä¾‹â€ç‰¹æ€§**ã€‚

---

### ğŸ” ä¸¾ä¸ªä¾‹å­

#### `counter.js`
```js
// æ¨¡å—çº§å˜é‡ï¼ˆåªåˆå§‹åŒ–ä¸€æ¬¡ï¼ï¼‰
let count = 0;

export function increment() {
  count++;
  console.log('Count:', count);
}

export function getCount() {
  return count;
}
```

#### `app1.js`
```js
import { increment, getCount } from './counter.js';

increment(); // Count: 1
console.log(getCount()); // 1
```

#### `app2.js`
```js
import { increment, getCount } from './counter.js';

increment(); // Count: 2 â† æ³¨æ„ï¼ä¸æ˜¯ 1ï¼
console.log(getCount()); // 2
```

#### `main.js`
```js
import './app1.js'; // æ‰§è¡Œå count = 1
import './app2.js'; // æ‰§è¡Œå count = 2
```

âœ… è¾“å‡ºï¼š
```
Count: 1
1
Count: 2
2
```

> ğŸ’¡ å…³é”®ï¼š`count` å˜é‡åœ¨ `counter.js` ä¸­åªå£°æ˜äº†ä¸€æ¬¡ã€‚  
> å³ä½¿å¤šä¸ªæ–‡ä»¶ `import` å®ƒï¼Œå®ƒä»¬**å…±äº«åŒä¸€ä¸ª `count` å˜é‡** â€”â€” è¿™å°±æ˜¯ **æ¨¡å—å•ä¾‹**ï¼

---

## ä¸‰ã€ä¸ºä»€ä¹ˆ ESM æ˜¯å•ä¾‹ï¼ŸæŠ€æœ¯åŸç†

å½“ä½  `import` ä¸€ä¸ªæ¨¡å—æ—¶ï¼ŒJavaScript å¼•æ“ï¼ˆæˆ–æ‰“åŒ…å·¥å…·å¦‚ Webpackã€Viteï¼‰ä¼šï¼š

1. **æ£€æŸ¥æ˜¯å¦å·²åŠ è½½è¯¥æ¨¡å—**
   - å¦‚æœæ²¡æœ‰ï¼šæ‰§è¡Œæ¨¡å—ä»£ç ï¼Œç¼“å­˜å…¶å¯¼å‡ºç»“æœ
   - å¦‚æœæœ‰ï¼šç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœï¼ˆ**ä¸å†æ‰§è¡Œæ¨¡å—ä½“**ï¼‰

2. **æ¨¡å—ä½œç”¨åŸŸæ˜¯å°é—­çš„**ï¼Œä½†å†…éƒ¨çŠ¶æ€åœ¨å¤šæ¬¡ import é—´ä¿æŒ

è¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ **â€œæ‡’åŠ è½½ + ç¼“å­˜â€** æœºåˆ¶ï¼Œä¿è¯äº†æ¨¡å—çš„**æ‰§è¡Œå”¯ä¸€æ€§**ã€‚

---

## å››ã€å¯¹æ¯”ï¼šCommonJSï¼ˆNode.jsï¼‰ä¹Ÿæ˜¯å•ä¾‹å—ï¼Ÿ

âœ… **æ˜¯çš„ï¼** CommonJS åŒæ ·æ˜¯å•ä¾‹ï¼š

```js
// counter.js (CommonJS)
let count = 0;
exports.increment = () => {
  count++;
  console.log(count);
};
```

```js
// a.js
const c = require('./counter');
c.increment(); // 1

// b.js
const c = require('./counter');
c.increment(); // 2 â† å…±äº«çŠ¶æ€ï¼
```

Node.js ä¼šæŠŠæ¨¡å—ç¼“å­˜åœ¨ `require.cache` ä¸­ï¼Œä¸‹æ¬¡ç›´æ¥è¿”å›ç¼“å­˜ã€‚

---

## äº”ã€é‡è¦æ³¨æ„äº‹é¡¹ âš ï¸

### 1. **å•ä¾‹ â‰  å…¨å±€å˜é‡å®‰å…¨**
- åœ¨ **æµè§ˆå™¨å¤š Tab** ä¸­ï¼šæ¯ä¸ª Tab æ˜¯ç‹¬ç«‹ JS ç¯å¢ƒï¼Œä¸å…±äº«æ¨¡å—çŠ¶æ€
- åœ¨ **Node.js å¤šè¿›ç¨‹** ä¸­ï¼šæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„å†…å­˜ï¼Œæ¨¡å—ä¸å…±äº«
- ä½†åœ¨**åŒä¸€ä¸ª JS æ‰§è¡Œç¯å¢ƒå†…**ï¼ˆå¦‚åŒä¸€ä¸ªé¡µé¢ã€åŒä¸€ä¸ª Node è¿›ç¨‹ï¼‰ï¼Œæ¨¡å—æ˜¯å•ä¾‹

### 2. **SSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰ä¸­çš„é™·é˜±**
åœ¨ Next.js/Nuxt ç­‰ SSR æ¡†æ¶ä¸­ï¼š
- å¦‚æœæ¨¡å—çŠ¶æ€åœ¨**æœåŠ¡ç«¯**è¢«ä¿®æ”¹
- å¯èƒ½å¯¼è‡´**ä¸åŒç”¨æˆ·è¯·æ±‚ä¹‹é—´æ±¡æŸ“æ•°æ®**ï¼ˆå› ä¸º Node è¿›ç¨‹å¤ç”¨æ¨¡å—ï¼‰

âœ… è§£å†³æ–¹æ¡ˆï¼šé¿å…åœ¨æ¨¡å—é¡¶å±‚æ”¾ç”¨æˆ·ç›¸å…³çŠ¶æ€ï¼Œæˆ–æ¯æ¬¡è¯·æ±‚é‡ç½®ã€‚

---


## âœ… æ€»ç»“

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| **å•ä¾‹æ¨¡å¼** | ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ |
| **ESM æ¨¡å—æ˜¯å•ä¾‹** | æ¯ä¸ª `.js` æ–‡ä»¶åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¤šæ¬¡ `import` å…±äº«åŒä¸€ä»½å†…éƒ¨çŠ¶æ€ |
| **æœ¬è´¨** | æ¨¡å—ç³»ç»Ÿé€šè¿‡**ç¼“å­˜æœºåˆ¶**å®ç°å•ä¾‹è¡Œä¸º |
| **ç”¨é€”** | é€‚åˆå®ç°å…¨å±€é…ç½®ã€è®¡æ•°å™¨ã€å·¥å…·åº“ç­‰æ— çŠ¶æ€/å…±äº«çŠ¶æ€é€»è¾‘ |
| **æ³¨æ„** | ä¸é€‚ç”¨äºå­˜å‚¨ç”¨æˆ·ç§æœ‰æ•°æ®ï¼ˆå°¤å…¶åœ¨ SSR åœºæ™¯ï¼‰ |

> ğŸ’¡ ä¸€å¥è¯è®°ä½ï¼š  
> **â€œESM æ¨¡å— = è‡ªåŠ¨å•ä¾‹â€** â€”â€” ä½ ä¸éœ€è¦æ‰‹åŠ¨å®ç°å•ä¾‹ï¼Œæ¨¡å—æœ¬èº«å°±æ˜¯è¿™æ ·å·¥ä½œçš„ï¼

## Demo

```html
<button id="loginBtn">æŒ‰é’®</button>
<script>
  var num = 1;
  var createLoginLayer = function () {
    num++;
    var div = document.createElement('div');
    div.innerHTML = 'ç™»å½•çª—';
    div.style.display = 'none';
    document.body.appendChild(div);
    return div;
  };

  var getSingle = function (fn) {
    var result;
    return function () {
      // getSingle æ‰§è¡Œå®Œ reault æ²¡æœ‰è¢«å›æ”¶ï¼Œè€Œæ˜¯æŒ‡å‘ fn çš„è¿”å›å€¼ï¼Œå½¢æˆé—­åŒ…
      return result || (result = fn.apply(this, arguments));
    };
  };

  var createSingleLoginLayer = getSingle(createLoginLayer);

  document.getElementById('loginBtn').onclick = function () {
    console.log(num);
    var loginLayer = createSingleLoginLayer();
    loginLayer.style.display = 'block';
  };
</script>
```

